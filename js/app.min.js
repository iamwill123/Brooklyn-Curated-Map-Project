function plusDivs(a){showDivs(slideIndex+=a)}function currentDiv(a){showDivs(slideIndex=a)}function showDivs(a){var b,c=document.getElementsByClassName("mySlides"),d=document.getElementsByClassName("dots");for(a>c.length&&(slideIndex=1),1>a&&(slideIndex=c.length),b=0;b<c.length;b++)c[b].style.display="none";for(b=0;b<d.length;b++)d[b].className=d[b].className.replace(" w3-white","");c[slideIndex-1].style.display="block",d[slideIndex-1].className+=" w3-white"}var map,infoWindow=new google.maps.InfoWindow({maxWidth:400,maxHeight:570}),slideIndex=1,ViewModel=function(){var a=this;a.venueList=ko.observableArray([]),a.filteredVenueList=ko.observableArray([]),a.filter=ko.observable(""),a.initialize=function(){function a(){null==d.getMap()?d.setMap(map):d.setMap(null)}var b=new google.maps.StyledMapType([{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.landcover",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#00ffff"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#00fbff"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway.controlled_access",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#00fffb"},{lightness:18}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#00ffff"},{lightness:16}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19},{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000303"},{lightness:17}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],{name:"Tron"}),c=new google.maps.StyledMapType([{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}],{name:"Vibrant"}),d=new google.maps.TrafficLayer;map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.708116,lng:-73.95707},zoom:12,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT,mapTypeIds:["roadmap","terrain","styled_tron","styled_vibrant"]}}),map.mapTypes.set("styled_tron",b),map.setMapTypeId("styled_tron"),map.mapTypes.set("styled_vibrant",c),map.setMapTypeId("styled_vibrant"),document.getElementById("toggle-traffic").addEventListener("click",function(){a()})},a.buildVenueLocations=function(){venueLocations.forEach(function(b){a.venueList.push(new Venue(b))})},a.setVenueClickFunctions=function(){a.venueList().forEach(function(b){google.maps.event.addListener(b.marker(),"click",function(){a.venueClick(b)})})},a.venueClick=function(b){a.getYelpData(b),a.getGoogleMapsData(b);var c='<div class="w3-center w3-display-bottommiddle" style="width:100%"><div class="w3-left w3-padding-left w3-hover-text" onclick="plusDivs(-1)">&#10094;</div><div class="w3-right w3-padding-right w3-hover-text" onclick="plusDivs(1)">&#10095;</div><div id="w3-dots"></div></div>',d='<div class="infoWindow-styling"><div class="venue-header" id="venue-name">'+b.name()+'</div><div class="content-left"><img class="yelp-thumb-image" id="yelp-image"></div><div class="content-right"><p><span class="yelp-rating-image"><img id="yelp-rating"></span><span class="yelp-rating-count" id="yelp-rating-count"></span></p><div class="cta-url"><span><a class="yelp-website" id="yelp-url" target="_blank">YELP</a></span> <span><a class="business-website" id="business-website" target="_blank">WEBSITE</a></span> </div><p class="venue-neighborhood" id="venue-neighborhood">Hood? '+b.neighborhood()+'</p><p class="venue-address" id="venue-address">'+b.address()+'</p></div><div class="content-fill"><p class="yelp-about" id="yelp-about-snippet"></p><div class="w3-content w3-display-container"><div class="image-gallery" id="image-gallery">'+c+'</div></div><div class="google-directions" id="google-directions"><input id="search-text" type="text" placeholder="Take me here! Enter origin address" autocomplete="off"><select id="mode"><option value="TRANSIT">Transit</option><option value="DRIVING">Drive</option><option value="WALKING">Walk</option><option value="BICYCLING">Bike</option></select></div></div></div>';infoWindow.setContent(d),infoWindow.open(map,b.marker());var e=$(".gm-style-iw").parent();e.stop().hide(),e.fadeIn(1500),map.panTo({lat:b.lat(),lng:b.lng()}),map.setZoom(13),map.panBy(0,-250);var f=(new google.maps.places.Autocomplete(document.getElementById("search-text")),new google.maps.DirectionsService),g=new google.maps.DirectionsRenderer,h=function(){a.displayGoogleDirections(b,f,g)};document.getElementById("mode").addEventListener("change",h),document.getElementById("search-text").addEventListener("keypress",function(a){13==a.keyCode&&h()});var i=$(".gm-style-iw"),j=i.next();j.on("click",function(){g.setMap(null)});var k=$(".mdl-navigation__link");k.on("click",function(){g.setMap(null)}),a.setMarkerAnimation(b)},a.setMarkerAnimation=function(a){a.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.marker().setAnimation(null)},750)},a.filterVenues=ko.computed(function(b){a.filteredVenueList([]);var c=a.filter().toLowerCase();$.each(a.venueList(),function(b){var d=a.venueList()[b].name().toLowerCase();if(d.indexOf(c)>-1){a.filteredVenueList.push(a.venueList()[b]),a.venueList()[b].marker().setMap(map);var e=a.venueList()[b].marker().getPosition();map.panTo(e)}else a.venueList()[b].marker().setMap(null)})},a),a.getYelpData=function(a){function b(){return Math.floor(1e12*Math.random()).toString()}var c="GET",d="http://api.yelp.com/v2/search/",e="Ff-UjdYVgCfiI2lXXqK6ZA",f="ayaZ2gPDYwTORpJ3EgnlnI8sEGc",g="iT9LEQqPxqNuvL8cFVyTSSAlYFJer9Jd",h="Hro-TZlsX2NHIe7SWC0f2n5HquE",i={oauth_consumer_key:e,oauth_token:g,oauth_nonce:b(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:a.name(),location:"Brooklyn, NY"},j=oauthSignature.generate(c,d,i,f,h);i.oauth_signature=j;var k={url:d,data:i,cache:!0,dataType:"jsonp",success:function(a,b){console.log("YELP Search API Request: "+b);var c=a.businesses[0];$("#yelp-image").attr("src",c.image_url),$("#yelp-rating").attr("src",c.rating_img_url),$("#yelp-rating-count").html(" "+c.review_count+" reviews"),$("#yelp-url").attr("href",c.url),$("#yelp-about-snippet").html('"'+c.snippet_text+'"')},error:function(){console.log("YELP Search API Error Status: "+status),$("#text").html("Data could not be retrieved from yelp.")}};$.ajax(k)},a.getGoogleMapsData=function(a){var b=new google.maps.places.PlacesService(map),c=a.pid();b.getDetails(c,function(a,b){return b!==google.maps.places.PlacesServiceStatus.OK?void console.error("Google API Places Request: "+b):($("#business-website").attr("href",a.website),a.photos&&$(a.photos).each(function(b){$("#image-gallery").append(function(){var c='<img class="gm-content mySlides w3-round" data-scale="best-fit-down" data-align="center" src="'+a.photos[b].getUrl({maxHeight:200,maxWidth:200})+'" style="margin:1rem auto;">';return c}),console.log("there are:"+a.photos.length+" photos total"),$("#w3-dots").append(function(){var a='<span class="w3-badge dots w3-border w3-transparent w3-hover-white" onclick="currentDiv('+(b+1)+')"></span>';return a})}),showDivs(slideIndex),void console.log("Google API Places Request: "+b))})},a.displayGoogleDirections=function(a,b,c){c.setMap(map);var d=document.getElementById("search-text").value,e=document.getElementById("mode").value;b.route({origin:d,destination:a.address(),travelMode:google.maps.TravelMode[e]},function(a,b){b===google.maps.DirectionsStatus.OK?c.setDirections(a):window.alert("Directions request failed due to "+b)})},google.maps.event.addDomListener(window,"load",function(){a.initialize(),a.buildVenueLocations(),a.setVenueClickFunctions(),a.filteredVenueList(a.venueList())}),google.maps.event.addDomListener(window,"resize",function(){var a=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(a)}),google.maps.event.addDomListener(infoWindow,"domready",function(){var a=$(".gm-style-iw"),b=a.prev();b.children(":nth-child(2)").css({display:"none"}),b.children(":nth-child(4)").css({display:"none"}),b.children(":nth-child(3)").find("div").children().css({"box-shadow":"#333333 0px 1px 6px","z-index":"0","background-color":"#333333"});var c=a.next();c.css({opacity:"1",width:"19px",height:"19px",right:"30px",top:"17px",border:"3px solid #333333","border-radius":"5px","background-color":"#333333",color:"white"}),c.toggleClass(function(){$(this).css({opacity:"1","background-color":"white"})})})},Venue=function(a){function b(a){var b=new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+a+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34));return b}var c,d=this;d.name=ko.observable(a.name),d.lat=ko.observable(a.lat),d.lng=ko.observable(a.lng),d.address=ko.observable(a.address),d.neighborhood=ko.observable(a.neighborhood),d.pid=ko.observable(a.pid);var e=b("44a2a1"),f=b("00BCD4");c=new google.maps.Marker({position:new google.maps.LatLng(d.lat(),d.lng()),map:map,title:d.name(),icon:e,animation:google.maps.Animation.DROP}),c.addListener("mouseover",function(){this.setIcon(f)}),c.addListener("mouseout",function(){this.setIcon(e)}),d.marker=ko.observable(c)};ko.bindingHandlers.fadein={init:function(a,b){var c=b();$(a).toggle(ko.unwrap(c))},update:function(a,b){var c=b();ko.unwrap(c)?$(a).fadeIn():$(a).fadeOut()}},ko.applyBindings(new ViewModel);